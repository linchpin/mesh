var mesh;!function(l,r){"use strict";l.widget("vanderlee.limitslider",l.ui.slider,{options:l.extend({classEven:"ui-slider-handle-even",classOdd:"ui-slider-handle-odd",gap:r,left:r,right:r,limit:r,limits:r,ranges:[],title:!1,label:!1},l.ui.slider.prototype.options),_create:function(){this.options.values||(this.options.values=[this.options.value]),l.ui.slider.prototype._create.call(this),l(this.element).addClass("ui-limitslider"),this._renderRanges(),this._renderLabels(),this._renderTitles()},_renderTitle:function(e){if(this.options.title){var t=this.options.values[e];l(this.handles[e]).attr("title",l.isFunction(this.options.title)?this.options.title(t,e):t).addClass(this.options[e%2?"classEven":"classOdd"])}},_renderTitles:function(e){if(this.options.title){var t=this;l.each(this.options.values,function(e){t._renderTitle(e)})}},_renderLabel:function(e){if(this.options.label){var t=this.options.values[e],s=l("<div>").css({"text-align":"center","font-size":"75%",display:"table-cell","vertical-align":"middle"}).html(l.isFunction(this.options.label)?this.options.label(t,e):t);l(this.handles[e]).html(s).css({"text-decoration":"none",display:"table"})}},_renderLabels:function(){if(this.options.label){var t=this;l.each(this.options.values,function(e){t._renderLabel(e)})}},_renderRanges:function(){var e,t,s,i=this.options,a=i.values,n=function(e){return 100*(e-i.min)/(i.max-i.min)};for(l(".ui-slider-range",this.element).remove(),e=0;e<=a.length;++e){var o,r;(o=i.ranges[e])&&(t=n(0==e?i.min:a[e-1]),s=n(e<a.length?a[e]:i.max),r=l("<div/>").addClass("ui-slider-range ui-widget-header").css("width",s-t+"%"),o.styleClass&&r.addClass(o.styleClass),0==t?r.addClass("ui-slider-range-min"):100==s?r.addClass("ui-slider-range-max"):r.css("left",t+"%"),l(this.element).prepend(r))}},_slide:function(e,t,s){this.options.left&&(s=Math.max(s,this.options.left)),this.options.right&&(s=Math.min(s,this.options.right)),this.options.limit&&(s=Math.max(s,this.options.limit[0]),s=Math.min(s,this.options.limit[1])),this.options.limits&&this.options.limits[t]&&(s=Math.max(s,this.options.limits[t][0]),s=Math.min(s,this.options.limits[t][1])),(this.options.gap||0===this.options.gap)&&(0<t&&(s=Math.max(s,this.options.values[t-1]+this.options.gap)),t<this.options.values.length-1&&(s=Math.min(s,this.options.values[t+1]-this.options.gap))),l.ui.slider.prototype._slide.call(this,e,t,s)},_change:function(e,t){l.ui.slider.prototype._change.call(this,e,t),this._renderRanges(),this._renderLabel(t),this._renderTitle(t)},insert:function(e,t,s,i){var a,n,o=this.options.values.length;return e=null==e?o:Math.max(0,Math.min(e,o)),void 0===t&&(a=e<=0?this.options.min:this.options.values[e-1],n=o<=e?this.options.max:this.options.values[e],t=Math.round(.5*(a+n))),this.options.values.splice(e,0,t),this.options.ranges&&this.options.ranges.splice(e,0,s||!1),this.options.limits&&this.options.limits.splice(e,0,s||r),this._create(),this.element.trigger("slide",[e,t]),this},remove:function(e,t){var s=this.options.values.length-1;return(t=Math.max(1,t||1))-1<s&&(e=null==e?s+1-t:Math.max(0,Math.min(e,s)),this.options.values.splice(e,t),this.options.ranges&&this.options.ranges.splice(e,t),this.options.limits&&this.options.limits.splice(e,t),this._create()),this}})}(jQuery),(mesh=mesh||{}).pointers=function(s){var i=0;return{show_pointer:function(){if(void 0!==mesh_data.wp_pointers){var e=mesh_data.wp_pointers.pointers[i],t=s.extend(e.options,{close:function(){s.post(ajaxurl,{pointer:e.pointer_id,action:"dismiss-wp-pointer"}),++i<mesh_data.wp_pointers.pointers.length&&mesh.pointers.show_pointer()}});s(e.target).pointer(t).pointer("open")}}}}(jQuery),(mesh=mesh||{}).blocks=function(h){var c,r,e=h("body"),s={};return{init:function(){c=mesh.blocks,r=mesh.admin,"post"===mesh_data.screen&&(e.on("click",".mesh-block-featured-image-trash",c.remove_background).on("click",".mesh-block-featured-image-choose",c.choose_background).on("click.OpenMediaManager",".mesh-block-featured-image-choose",c.choose_background).on("click",".mesh-clean-edit:not(.title-input-visible)",c.show_field).on("blur",".mesh-clean-edit-element:not(select)",c.hide_field).on("click",".close-title-edit",c.hide_field).on("click",".slide-toggle-element",c.slide_toggle_element).on("change",".mesh-column-offset",c.display_offset).on("change","input.mesh-section-centered",c.display_centered).on("mouseenter",".the-mover",function(){h(this).closest(".block").addClass("ui-hover-state")}).on("mouseleave",".the-mover",function(){h(this).closest(".block").removeClass("ui-hover-state")}).on("change",".mesh-block-columns.column-width",function(e){c.change_block_widths(e)}),c.setup_resize_slider(),c.setup_sortable())},setup_sortable:function(){var n=[];h(".mesh-editor-blocks > .mesh-row[data-section-blocks]").sortable({axis:"x",cursor:"move",cursorAt:{left:0},distance:20,handle:".the-mover",items:".mesh-section-block",tolerance:"pointer",create:function(e,t){h(".mesh-editor-blocks .fade-in-on-create").fadeIn("slow")},start:function(e,t){h(e.target).find(".column-slider").fadeOut("fast"),h(".mesh-section-block:not(.ui-sortable-placeholder)",this).each(function(){n.push(h(this).attr("class"))})},stop:function(e,t){h(e.target).find(".column-slider").fadeIn("slow")},update:function(e,t){var s=h(this),i=h(e.target).parents(".mesh-section"),a=i.attr("data-mesh-section-id");s.find(".mesh-section-block").each(function(e){var t=h(this);t.removeAttr("class").addClass(n[e]),t.find(".block-menu-order").val(e)}),c.rerender_blocks(i.find(".wp-editor-area")),c.save_order(a,e,t),c.setup_sortable()}})},change_block_widths:function(e,t){var s=h(e.target);void 0===t&&((t={}).values=[parseInt(s.val())]);var i=s.parents(".mesh-section").find(".mesh-editor-blocks").find(".mesh-row:first .columns").addClass("dragging"),a=i.length,n=parseInt(mesh_data.max_columns),c=[],o=t.values,d={post_id:parseInt(mesh_data.post_id),section_id:parseInt(s.closest(".mesh-section").attr("data-mesh-section-id")),blocks:{}};if(3===a)for(var r=0;r<=a;r++)switch(r){case 0:c.push(o[r]);break;case 1:c.push(o[r]-o[0]);break;case 2:c.push(n-o[1])}2===a&&(c.push(o[0]),c.push(n-o[0])),1===a&&c.push(s.val()),i.removeClass(function(e,t){return(t.match(/\mesh-columns-\d+/g)||[]).join(" ")}).each(function(e){var t=h(this),s=parseInt(t.find(".block").attr("data-mesh-block-id")),i=t.find(".column-width"),a=t.find(".mesh-column-offset"),n=a.val(),o=parseInt(c[e]),r=o-3;a.children("option").remove();for(var l=0;l<=r;l++)a.append(h("<option></option>").attr("value",l).text(l));r<n?a.val(0).trigger("change"):a.val(n).trigger("change"),t.addClass("mesh-columns-"+o),o<=4?t.addClass("mesh-small-block"):t.removeClass("mesh-small-block"),s&&c[e]&&(i.val(o),d.blocks[s.toString()]=o)})},setup_resize_slider:function(){h(".column-slider").addClass("ui-slider-horizontal").each(function(){var s=h(this),e=parseInt(s.attr("data-mesh-blocks")),t=2<e,i=h.parseJSON(s.attr("data-mesh-columns")),a={range:t,min:0,max:parseInt(mesh_data.max_columns),step:1,left:3,right:9,gap:3,create:function(){var e=h(".ui-slider-handle");e.find(".inner-border").remove(),e.append(h('<span class="inner-border" />'))},start:function(e,t){s.css("z-index",1e3),h(e.target).parents(".mesh-section").find(".mesh-editor-blocks").find(".mesh-row:first .columns").each(function(){var e=h(this).find('.mce-first.mce-btn-group .mce-btn[role="button"]');e.hide(),h(e[0]).css("visibility","hidden").show()})},stop:function(e,t){s.css("z-index","").find(".ui-slider-handle").css("z-index",1e3),c.notify_user(e,t)},slide:c.change_block_widths,change:function(e,t){var s=h(e.target).parents(".mesh-section").find(".mesh-editor-blocks").find(".mesh-row:first .columns");c.rerender_blocks(s.find(".wp-editor-area"))}};i&&(a.value=i[0]),3===e&&(i[1]=i[0]+i[1],i.pop(),a.values=i,a.value=null),s.limitslider(a)})},notify_user:function(e,t){h(e.target).parents(".mesh-section").find(".mesh-editor-blocks").find(".mesh-row:first .columns").removeClass("dragging")},rerender_blocks:function(e){e.each(function(){var e=h(this).prop("id"),t="content",s=h(this).closest(".mesh-section-block"),i=h.extend(!0,{},mesh_data.tinymce_options),a=[];if(s.find(".mesh-block-columns").val()<=4?(s.addClass("mesh-small-block"),i.toolbar1=mesh_data.tinymce_options.small_toolbar1,i.toolbar2=mesh_data.tinymce_options.small_toolbar2):s.removeClass("mesh-small-block"),"undefined"!=typeof tinymce){4<=parseInt(tinymce.majorVersion)&&tinymce.execCommand("mceRemoveEditor",!1,e);var n=h(this).closest(".block-content");c.create_editor(e,i,n);try{"html"!==mesh.blocks.mode_enabled(this)&&h(this).closest(".wp-editor-wrap").on("click.wp-editor",function(){this.id&&(window.wpActiveEditor=this.id.slice(3,-5))})}catch(e){console.log(e)}try{void 0!==tinyMCEPreInit.qtInit[t]&&((a=tinyMCEPreInit.qtInit[t]).id=a.id.replace(t,e),(tinyMCEPreInit.qtInit[e]=a).buttons="strong,em,link,block,img,ul,ol,li","undefined"!=typeof quicktags&&quicktags(tinyMCEPreInit.qtInit[e]),"undefined"!=typeof QTags&&QTags._buttonsInit())}catch(e){console.log(e)}if(n.find(".switch-tmce").trigger("click"),"undefined"!=typeof tinymce){var o=tinymce.get(e),r=c.get_block_cache(e);o&&!o.hidden?r&&(o.setContent(r),c.delete_block_cache(e)):r&&o.val(r)}}}),void 0!==mesh.integrations.yoast&&mesh.integrations.yoast.addMeshSections()},mode_enabled:function(e){return h(e).closest(".html-active").length?"html":"tinymce"},save_order:function(e,t,s){h(".mesh-reorder-spinner");var i=[];h("#mesh-sections-editor-"+e).find(".block").each(function(){i.push(h(this).attr("data-mesh-block-id"))})},choose_background:function(e){e.preventDefault(),e.stopPropagation();var i=h(this),t=i.parents(".block"),a="mesh-background-select-"+parseInt(t.attr("data-mesh-block-id")),n=parseInt(i.parent().find(".mesh-block-background-input").val()),o=i.parents(".mesh-section-background");if(r.media_frames=r.media_frames||[],r.media_frames[a])return r.media_frames[a].uploader.uploader.param("mesh_upload","true"),void r.media_frames[a].open();r.media_frames[a]=wp.media.frames.media_frames=wp.media({className:"media-frame mesh-media-frame",frame:"select",multiple:!1,title:mesh_data.strings.select_block_bg,button:{text:mesh_data.strings.select_bg}}),r.media_frames[a].on("open",function(){r.media_frames[a].state().get("selection").add(wp.media.attachment(n))}),r.media_frames[a].on("select",function(){var e=r.media_frames[a].state().get("selection").first().toJSON(),t=(h("<span />",{class:"dashicons dashicons-edit"}),h("<a/>",{"data-mesh-section-featured-image":"",href:"#",class:"mesh-block-featured-image-trash dashicons-before dashicons-dismiss"}));n=e.id;var s=h("<img />",{src:e.url});i.html(s).attr("data-mesh-section-featured-image",parseInt(e.id)).after(t),o.addClass("has-background-set"),i.siblings('input[type="hidden"]').val(e.id)}),r.media_frames[a].open()},remove_background:function(e){e.preventDefault(),e.stopPropagation();var t=h(this);t.prev().hasClass("right")&&!t.prev().hasClass("button")&&(t.parents(".block-background-container")?t.prev().toggleClass("right").attr("data-mesh-block-featured-image",""):t.prev().toggleClass("button right")),t.siblings('input[type="hidden"]').val(""),t.prev().text(mesh_data.strings.add_image),t.remove()},show_field:function(e){e.preventDefault(),e.stopPropagation(),h(this).parents(".mesh-postbox").hasClass("closed")||h(this).addClass("title-input-visible")},hide_field:function(e){e.preventDefault(),e.stopPropagation(),h(this).parent().removeClass("title-input-visible")},slide_toggle_element:function(e){e.preventDefault(),e.stopPropagation();var t=h(this),s=t.data("toggle");h(s).slideToggle("fast"),t.toggleClass("toggled")},display_offset:function(e){var t=h(this),s=parseInt(t.val()),i=t.parents(".block-header").next(".block-content");i.removeClass("mesh-has-offset mesh-offset-1 mesh-offset-2 mesh-offset-3 mesh-offset-4 mesh-offset-5 mesh-offset-6 mesh-offset-7 mesh-offset-8 mesh-offset-9"),s&&i.addClass("mesh-has-offset mesh-offset-"+s)},setup_drag_drop:function(){h(".mesh-editor-blocks .block").draggable({appendTo:"body",helper:function(e){var t=h(this),s=t.width();return $clone=t.clone().width(s).css("background","#fff"),$clone.find("*").removeAttr("id"),$clone},revert:!0,zIndex:1e3,handle:".the-mover",iframeFix:!0,start:function(e,t,s){}}),h(".block").addClass("ui-widget ui-widget-content ui-helper-clearfix").find(".block-header").addClass("hndle ui-sortable-handle").prepend("<span class='block-toggle' />"),h(".drop-target").droppable({accept:".block:not(.ui-sortable-helper)",activeClass:"ui-state-hover",hoverClass:"ui-state-active",handle:".block-header",revert:!0,drop:function(e,t){var s=h(this),i=t.draggable,a=t.draggable.parent(),n=h(e.target),o=n.find(".block"),r=n.parents(".mesh-section"),l=r.attr("data-mesh-section-id");return i.css({top:"",left:""}),s.append(i),a.append(o),c.rerender_blocks(r.find(".wp-editor-area")),c.save_order(l,e,t),c.setup_drag_drop(),!1}})},set_block_cache:function(e,t){return!(!e||!t)&&(s[e]=t,!0)},get_block_cache:function(e){return s[e]?s[e]:""},delete_block_cache:function(e){s[e]&&delete s[e]},get_tinymce_editors:function(e){return e.find(".wp-editor-area")},create_editor:function(e,t,s){if(void 0===tinyMCEPreInit.mceInit[e]){var i="content",a=s.html();a=a.replace(new RegExp('id="'+i+'"',"g"),'id="'+e+'"'),s.html(a),void 0!==tinyMCEPreInit.mceInit[i]&&((t=h.extend(!0,{},tinyMCEPreInit.mceInit[i],t)).body_class=t.body_class.replace(i,e),t.selector=t.selector.replace(i,e))}else t=h.extend(!0,{},tinyMCEPreInit.mceInit[e],t);tinyMCEPreInit.mceInit[e]=t},display_centered:function(e){var t=h(this),s=t.parents(".mesh-section-block"),i="mesh-block-centered";t.is(":checked")?s.addClass(i):s.removeClass(i)}}}(jQuery),(mesh=mesh||{}).templates=function(o){var t,r,e=o("body"),s=o("#mesh-template-welcome-panel");return{init:function(){t=mesh.templates,s.find(".mesh-template-welcome-panel-close").on("click",function(e){e.preventDefault(),s.addClass("hidden"),t.updateWelcomePanel(0)}),"post"===mesh_data.screen&&(r=mesh.blocks,e.on("click",".mesh-select-template",t.select_template).on("click",".mesh-template-layout",t.select_layout).on("click",".mesh-template-start",t.display_template_types).on("click",".mesh-template-change-type",t.change_template_type).on("click",".mesh-template-remove",t.remove_template))},warn_on_save:function(e){e.preventDefault(),e.stopPropagation(),!0!==confirm(mesh_data.strings.confirm_template_section_update)&&t.applyTemplateChanges()},applyTemplateChanges:function(){o.post(ajaxurl,{action:"mesh_apply_template_changes",mesh_post_id:mesh_data.post_id,mesh_template_id:template,mesh_template_type:template_type,mesh_choose_template_nonce:mesh_data.choose_template_nonce},function(e){})},updateWelcomePanel:function(e){o.post(ajaxurl,{action:"mesh_template_update_welcome_panel",visible:e,meshtemplatepanelnonce:o("#mesh-templates-welcome-panel-nonce").val()})},remove_template:function(e){},change_template_type:function(e){e.preventDefault(),e.stopPropagation(),o.post(ajaxurl,{action:"mesh_change_template_type",mesh_post_id:mesh_data.post_id,mesh_template_type:"starter",mesh_choose_template_nonce:mesh_data.choose_template_nonce},function(e){if(e){var t=o(e),s=t.find(".wp-editor-area"),i=o(".empty-sections-message"),a=o(".mesh-main-ua-row"),n=o("#mesh-container");n.html("").append(t.children()),i.length&&(i.fadeOut("fast"),a.fadeIn("fast")),1<o(".mesh-section",n).length&&o(".mesh-section-reorder").removeClass("disabled"),r.setup_resize_slider(),r.setup_sortable(),r.rerender_blocks(s),r.$sections=o(".mesh-section",o("#mesh-sections-container"))}})},display_template_types:function(e){e.preventDefault(),e.stopPropagation(),t.select_template_type(e)},select_template_type:function(e){e.preventDefault(),e.stopPropagation();var t=o(this),s=o(".mesh-template:checked").val(),i=t.attr("data-template-type");o.post(ajaxurl,{action:"mesh_choose_template",mesh_post_id:mesh_data.post_id,mesh_template_id:s,mesh_template_type:i,mesh_choose_template_nonce:mesh_data.choose_template_nonce},function(e){if(e){var t=o(e),s=t.find(".wp-editor-area"),i=o(".empty-sections-message"),a=o(".mesh-main-ua-row"),n=o("#mesh-sections-container");n.append(t),i.length&&(i.fadeOut("fast"),a.fadeIn("fast")),1<o(".mesh-section",o("#mesh-container")).length&&o(".mesh-section-reorder").removeClass("disabled"),r.setup_resize_slider(),r.setup_sortable(),r.rerender_blocks(s),r.$sections=o(".mesh-section",n)}})},select_layout:function(e){e.preventDefault(),e.stopPropagation();var t=o(this);o(".mesh-template-layout").removeClass("active").removeProp("checked"),t.addClass("active").find(".mesh-template").prop("checked","checked")},select_template:function(e){e.preventDefault(),e.stopPropagation();var t=o(this),s=t.siblings(".spinner");if(t.hasClass("disabled"))return!1;s.addClass("is-active"),o.post(ajaxurl,{action:"mesh_list_templates",mesh_post_id:mesh_data.post_id,mesh_choose_template_nonce:mesh_data.choose_template_nonce},function(e){if(e){var t=o(e);o("#mesh-description").html("").append(t),s.removeClass("is-active")}else s.removeClass("is-active")})}}}(jQuery),(mesh=mesh||{}).integrations=mesh.integrations||{},mesh.admin=function(d){var h,m,p,t,s,i,a=d("body"),o=(d("document"),d(".mesh-section-reorder")),n=d(".mesh-section-add"),r=d(".mesh-section-collapse"),l=d(".mesh-section-expand"),u=d("#mesh-container"),_=d("#mesh-sections-container"),c=d("#mesh-description"),f=d("[data-equalizer]"),v=[];return{init:function(){if("post"===mesh_data.screen||"edit"===mesh_data.screen||"settings_page_mesh"===mesh_data.screen){"edit"===mesh_data.screen&&(s=mesh.templates).init(),m=mesh.admin,p=mesh.blocks,t=mesh.pointers,s=mesh.templates,a.on("click",".mesh-section-add",m.add_section).on("click",".mesh-section-remove",m.remove_section).on("click",".mesh-section-reorder",m.reorder_sections).on("click",".mesh-save-order",m.save_section_order).on("click",".mesh-featured-image-trash",m.remove_background).on("click",".mesh-section-expand",m.expand_all_sections).on("click",".mesh-section-collapse",m.collapse_all_sections).on("click",".mesh-featured-image-choose",m.choose_background).on("click.OpenMediaManager",".mesh-featured-image-choose",m.choose_background).on("click",".mesh-trash-extra-blocks",m.trash_extra_blocks).on("click",".mesh-section-update",m.section_save).on("click",".mesh-section-save-draft",m.section_save_draft).on("click",".mesh-section-publish",m.section_publish).on("change",".mesh-choose-layout",m.choose_layout).on("keypress",".mesh-clean-edit-element",m.prevent_submit).on("keyup",".mesh-clean-edit-element",m.change_input_title).on("change","select.mesh-clean-edit-element",m.change_select_title).on("change","#mesh-css_mode",m.display_foundation_options).on("change","#mesh-foundation_version",m.display_foundation_grid_options);var e=void 0!==e?e:"";d(document).on("postbox-toggled",{event:e},m.expand_section),(h=d(".mesh-section")).length<=1&&o.addClass("disabled"),f.length&&f.each(m.mesh_equalize),p.init(),t.show_pointer(0),s.init(),m.setup_notifications(u),m.display_foundation_options(),m.display_foundation_grid_options()}},setup_notifications:function(e){e.find(".notice.is-dismissible").each(function(){var t=d(this),e=d('<button type="button" class="notice-dismiss"><span class="screen-reader-text"></span></button>'),s=commonL10n.dismiss||"";e.find(".screen-reader-text").text(s),t.append(e),e.on("click.wp-dismiss-notice",function(e){e.preventDefault(),d.post(ajaxurl,{action:"mesh_dismiss_notification",mesh_notification_type:t.attr("data-type"),_wpnonce:mesh_data.dismiss_nonce},function(e){}),t.fadeTo(100,0,function(){d(this).slideUp(100,function(){d(this).remove()})})})})},expand_section:function(e,t){var s=d(t),i=s.find(".wp-editor-area");s.hasClass("closed")||p.rerender_blocks(i)},expand_all_sections:function(t){t.preventDefault(),t.stopPropagation(),h.each(function(){var e=d(this).find(".handlediv");"true"!=e.attr("aria-expanded")&&(e.trigger("click"),m.expand_section(t,d(this)))})},collapse_all_sections:function(e){void 0!==e&&(e.preventDefault(),e.stopPropagation()),_.find(".handlediv").each(function(){var e=d(this);("true"==e.attr("aria-expanded")||e.hasClass("toggled"))&&e.trigger("click")})},toggle_collapse:function(e){var t,s=d(this),i=s.parent(".postbox"),a=i.attr("id");i.toggleClass("closed"),t=!i.hasClass("closed"),s.hasClass("handlediv")?s.attr("aria-expanded",t):s.closest(".postbox").find("button.handlediv").attr("aria-expanded",t),"press-this"!==postboxes.page&&postboxes.save_state(postboxes.page),a&&(!i.hasClass("closed")&&d.isFunction(postboxes.pbshow)?postboxes.pbshow(a):i.hasClass("closed")&&d.isFunction(postboxes.pbhide)&&postboxes.pbhide(a)),m.expand_section(e,i.closest(".mesh-section"))},choose_layout:function(e){e.preventDefault(),e.stopPropagation();var t=d(this),a=d(this).val(),n=t.siblings(".spinner"),s=t.parents(".mesh-section"),o=s.attr("data-mesh-section-id"),r=s.find(".mesh-section-meta").find(".mesh-more-section-options").hasClass("toggled");if(t.hasClass("disabled"))return!1;p.get_tinymce_editors(s).each(function(){var e="",t=d(this).prop("id"),s=tinymce.get(t);s&&!s.hidden&&(e=s.getContent()),p.set_block_cache(t,e)}),n.addClass("is-active"),m.disable_controls(s),d.post(ajaxurl,{action:"mesh_choose_layout",mesh_post_id:mesh_data.post_id,mesh_section_id:o,mesh_section_layout:a,mesh_choose_layout_nonce:mesh_data.choose_layout_nonce},function(e){if(e){var t,s=d(e),i=d("#mesh-section-"+o);(t=i.find(".wp-editor-area")).each(function(){4<=parseInt(tinymce.majorVersion)&&tinymce.execCommand("mceRemoveEditor",!1,d(this).prop("id"))}),s.find(".mesh-choose-layout").val(a),i.find(".inside").html("").append(s),r&&(i.find(".mesh-more-section-options").addClass("toggled"),i.find(".mesh-section-meta-dropdown").removeClass("hide").show()),t=i.find(".wp-editor-area"),p.setup_resize_slider(),p.setup_sortable(),p.rerender_blocks(t)}m.enable_controls(i),n.removeClass("is-active")})},add_section:function(e){e.preventDefault(),e.stopPropagation(),i=h.length;var r=d(this),l=r.find(".spinner"),c=d("#mesh-sections-container");if(r.hasClass("disabled"))return!1;m.disable_controls(u),r.addClass("active"),l.addClass("is-active"),d.post(ajaxurl,{action:"mesh_add_section",mesh_post_id:mesh_data.post_id,mesh_section_count:i,mesh_add_section_nonce:mesh_data.add_section_nonce},function(e){if(e){var t=d(e),s=t.find(".wp-editor-area"),i=d(".empty-sections-message"),a=d(".mesh-main-ua-row");_.append(t),l.removeClass("is-active"),r.removeClass("active"),i.length&&(i.fadeOut("fast").promise(function(){d("#description-wrap").remove()}),a.fadeIn("fast")),p.rerender_blocks(s),h=d(".mesh-section",_),t.find(".handlediv").attr("aria-expanded",!0).on("click",m.toggle_collapse),setTimeout(function(){mesh.pointers.show_pointer()},250),m.enable_controls(u),u.trigger("mesh:add_section"),p.setup_sortable()}else l.removeClass("is-active");var n=d(window).height()+d(window).scrollTop(),o=.5*(c.offset().top+c.outerHeight(!0)-n);o<1e3&&(o=1e3),3e3<o&&(o=3e3),d("html, body").animate({scrollTop:c.offset().top+c.outerHeight(!0)-d(window).height()},o)})},section_publish:function(e){e.preventDefault(),e.stopPropagation();var t=d(this).closest(".mesh-section"),s=d(".mesh-section-status",t),i=d(".mesh-section-status-text",t),a=d(".mesh-section-update",t);s.val("publish"),i.text(mesh_data.strings.published),a.trigger("click")},section_save_draft:function(e){e.preventDefault(),e.stopPropagation();var t=d(this).closest(".mesh-section");d(".mesh-section-update",t).trigger("click")},section_save:function(e){e.preventDefault(),e.stopPropagation();var t=d(this),i=t.parent(),a=i.find(".spinner"),n=i.find(".saved-status-icon"),o=t.closest(".mesh-section"),r=o.find(".mesh-section-status"),s=o.attr("data-mesh-section-id");o.find(".mesh-editor-blocks .wp-editor-area").each(function(){var e="",t=d(this).attr("id"),s=tinymce.get(t);s&&!s.hidden&&(e=s.getContent(),d("#"+t).val(e))});var l=o.parents("form").serialize();i.find(".button").addClass("disabled"),a.addClass("is-active"),d.post(ajaxurl,{action:"mesh_save_section",mesh_section_id:s,mesh_section_data:l,mesh_post_type:mesh_data.post_type,mesh_save_section_nonce:mesh_data.save_section_nonce},function(e){var t=i.find(".button");if(t.removeClass("disabled"),a.removeClass("is-active"),n.addClass("is-active").delay(2e3).queue(function(){d(this).removeClass("is-active").dequeue()}),e){var s=o.find(".mesh-section-publish, .mesh-section-save-draft");"publish"===r.val()?(t.removeClass("hidden"),s.addClass("hidden")):(t.addClass("hidden"),s.removeClass("hidden"))}})},remove_section:function(e){if(e.preventDefault(),e.stopPropagation(),confirm(mesh_data.strings.confirm_remove)){var a=d(this).parents(".mesh-postbox"),n=d(".mesh-add-spinner",a),t=a.attr("data-mesh-section-id");n.addClass("is-active"),d.post(ajaxurl,{action:"mesh_remove_section",mesh_post_id:mesh_data.post_id,mesh_section_id:t,mesh_remove_section_nonce:mesh_data.remove_section_nonce},function(e){if("1"===e)a.fadeOut(400,function(){a.remove(),u.find(".mesh-section").length<=1&&o.addClass("disabled")});else if("-1"===e)console.log("There was an error");else{var t=d(e),s=d(".mesh-main-ua-row"),i=d("#mesh-description");-1===e.indexOf("mesh-empty-actions")&&_.append(t),a.fadeOut(400,function(){a.remove(),0<e.indexOf("mesh-empty-actions")&&i.html("").append(t).show()}),s.fadeOut("fast"),n.removeClass("is-active")}})}},reorder_sections:function(e){e.preventDefault(),e.stopPropagation(),d(this).hasClass("disabled")||(m.disable_controls(u),u.addClass("mesh-is-ordering"),o.text(mesh_data.strings.save_order).addClass("mesh-save-order button-primary").removeClass("mesh-section-reorder"),m.collapse_all_sections(),_.sortable())},update_notifications:function(e,t){c.removeClass("notice-info notice-warning notice-success").addClass("notice-"+t).find("p").text(mesh_data.strings[e]),c.is(":visible")||c.css({opacity:0}).show(),c.fadeIn("fast")},save_section_order_sortable:function(e,t){var s=d(".mesh-reorder-spinner"),i=[];s.addClass("is-active"),d(".mesh-postbox",_).each(function(e){var t=d(this);i.push(t.attr("data-mesh-section-id")),t.find(".section-menu-order").val(e)})},save_section_order:function(e){e.preventDefault(),e.stopPropagation();d(this);var t=d(".mesh-reorder-spinner"),s=[];t.addClass("is-active"),u.removeClass("mesh-is-ordering"),m.enable_controls(u),o.text(mesh_data.strings.reorder).addClass("mesh-section-reorder").removeClass("mesh-save-order button-primary"),d(".mesh-postbox",_).each(function(e){var t=d(this);s.push(t.attr("data-mesh-section-id")),t.find(".section-menu-order").val(e)}),c.is(":visible")&&c.removeClass("notice-warning").addClass("notice-info").find("p").text(mesh_data.strings.description),m.save_section_ajax(s,t),_.sortable("destroy")},save_section_ajax:function(e,t){d.post(ajaxurl,{action:"mesh_update_order",mesh_post_id:parseInt(mesh_data.post_id),mesh_section_ids:e,mesh_reorder_section_nonce:mesh_data.reorder_section_nonce},function(e){t.removeClass("is-active")})},change_input_title:function(e){var t=d(this);if(!t.parents(".mesh-postbox").hasClass("closed")){var s=t.val(),i=t.siblings(".handle-title");t.is("select")||(""!==s&&"undefined"!=s||(s=mesh_data.strings.default_title),i.text(s))}},change_select_title:function(e){var t=d(this),s=t.val(),i=t.siblings(".handle-title");switch(s){case"publish":s=mesh_data.strings.published;break;case"draft":s=mesh_data.strings.draft}i.text(s)},prevent_submit:function(e){if(13==e.keyCode)return d(this).siblings(".close-title-edit").trigger("click"),e.preventDefault(),!1},block_click:function(e){e.stopImmediatePropagation()},remove_background:function(e){e.preventDefault(),e.stopPropagation();var t=d(this),s=t.parents(".mesh-section-background");t.prev().hasClass("right")&&!t.prev().hasClass("button")&&(t.parents(".block-background-container")?t.prev().toggleClass("right").attr("data-mesh-block-featured-image",""):t.prev().toggleClass("button right")),t.siblings('input[type="hidden"]').val(""),t.prev().text(mesh_data.strings.add_image),t.remove(),s.removeClass("has-background-set")},choose_background:function(e){e.preventDefault(),e.stopPropagation();var i=d(this),t=i.parents(".mesh-postbox"),a="mesh-background-select-"+parseInt(t.attr("data-mesh-section-id")),n=parseInt(i.parent().find(".mesh-section-background-input").val()),o=i.parents(".mesh-section-background");if(v[a])return v[a].uploader.uploader.param("mesh_upload","true"),void v[a].open();v[a]=wp.media.frames.media_frames=wp.media({className:"media-frame mesh-media-frame",frame:"select",multiple:!1,title:mesh_data.strings.select_section_bg,button:{text:mesh_data.strings.select_bg}}),v[a].on("open",function(){v[a].state().get("selection").add(wp.media.attachment(n))}),v[a].on("select",function(){var e=v[a].state().get("selection").first().toJSON(),t=(d("<span />",{class:"dashicons dashicons-edit"}),d("<a/>",{"data-mesh-section-featured-image":"",href:"#",class:"mesh-featured-image-trash dashicons-before dashicons-dismiss"}));n=e.id;var s=d("<img />",{src:e.url});i.html(s).attr("data-mesh-section-featured-image",parseInt(e.id)).after(t),o.addClass("has-background-set"),i.siblings('input[type="hidden"]').val(e.id),i.hasClass("button")&&!i.hasClass("right")&&i.toggleClass("button right")}),v[a].open()},mesh_equalize:function(){var e=d(this),t=d("[data-equalizer-watch]",e),s=0;t.each(function(){var e=d(this).height();s=s<e?e:s}).height(s)},trash_extra_blocks:function(e){e.preventDefault(),e.stopPropagation();var t=d(this).closest(".mesh-section").parents("form").serialize(),s=d(this).parents(".mesh-postbox"),i=s.attr("data-mesh-section-id");m.disable_controls(s),d.post(ajaxurl,{action:"mesh_trash_hidden_blocks",mesh_post_id:mesh_data.post_id,mesh_section_id:i,mesh_section_data:t,mesh_choose_layout_nonce:mesh_data.choose_layout_nonce,mesh_save_section_nonce:mesh_data.save_section_nonce},function(e){if("1"===e){var t=s.find(".description.notice");t.fadeOut(400,function(){t.remove()})}else"-1"===e&&console.log("There was an error");m.enable_controls(s)})},disable_controls:function(e){l.addClass("disabled"),n.addClass("disabled"),r.addClass("disabled"),o.addClass("disabled"),1<d(".mesh-section",_).length&&o.removeClass("disabled"),d(".disabled-overlay").remove(),e.find(".inside").css("position","relative").prepend('<div class="disabled-overlay" />')},enable_controls:function(e){l.removeClass("disabled"),n.removeClass("disabled"),r.removeClass("disabled"),1<d(".mesh-section",u).length?o.removeClass("disabled"):o.addClass("disabled"),e.find(".inside").find(".disabled-overlay").remove()},display_foundation_options:function(e){var t=d("#mesh-css_mode").find("option:selected").val(),s=d("#mesh-foundation_version"),i=s.closest("tr"),a=d("#mesh-grid_system"),n=a.closest("tr");1===parseInt(t)?i.show():(i.hide(),n.hide(),a.val(""),s.val(""))},display_foundation_grid_options:function(e){var t=d("#mesh-css_mode").find("option:selected").val(),s=d("#mesh-foundation_version"),i=d("#mesh-grid_system"),a=i.closest("tr");1===parseInt(t)&&6.4===parseFloat(s.val())?a.show():(a.hide(),i.val(""))}}}(jQuery),jQuery(function(e){mesh.admin.init()});